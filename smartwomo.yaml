#let this first part be generated by ESPhome
esphome:
  name: smartwomo

#maybe you need to adapt the ESP32 board manually as the Wemos D1 mini ESP32 is used
esp32:
  board: wemos_d1_mini32
  framework:
    type: arduino

# Enable logging
logger:

# Enable Home Assistant API
api:
  encryption:
    key: "<your encr<ption key here>"

ota:
  password: "<your ota password here>"

wifi:
  networks:
    - ssid: !secret wifi_ssid
      password: !secret wifi_password

    - ssid: <secondary ssid>
      password: <secondary ssid's password>

  # Enable fallback hotspot (captive portal) in case wifi connection fails
  ap:
    ssid: "Smartwomo Fallback Hotspot"
    password: "<fallback password>"

captive_portal:


# copy from here to your automaically generated YAML by ESPhome
#just enable if you really need a web server
web_server:
  port: 80


# Setup I2C 
i2c:
  sda: 18
  scl: 19
  scan: true #do we need a scan?
  id: bus_a

# define PCF8574 as INPUT hub
pcf8574:
  - id: 'pcf8574_hub'
    address: 0x20 #0x38
    pcf8575: false

# define analog sensor for testing purposes - can be deleted 
sensor:
  - platform: adc
    pin: 32
    name: "Analog pressure sensor"
    update_interval: 1s

# Define IN channels, toggling assigned OUT Lights when status changes
binary_sensor:
  - platform: gpio
    name: "Eingang IN1"
    id: Input_1
    pin: 
      pcf8574: pcf8574_hub
      number: 0
      mode:
        input: true
      inverted: false
    on_state:      
      then:
      - light.toggle:
          id: PWM_1

  - platform: gpio
    name: "Eingang IN2"
    id: Input_2
    pin: 
      pcf8574: pcf8574_hub
      number: 1
      mode:
        input: true
      inverted: false
    on_state:      
      then:
      - light.toggle:
          id: PWM_2

  - platform: gpio
    name: "Eingang IN3"
    id: Input_3
    pin: 
      pcf8574: pcf8574_hub
      number: 2
      mode:
        input: true
      inverted: false
    on_state:      
      then:
      - light.toggle:
          id: PWM_3

  - platform: gpio
    name: "Eingang IN4"
    id: Input_4
    pin: 
      pcf8574: pcf8574_hub
      number: 3
      mode:
        input: true
      inverted: false
    on_state:      
      then:
      - light.toggle:
          id: PWM_4

  - platform: gpio
    name: "Eingang IN5"
    id: Input_5
    pin: 
      pcf8574: pcf8574_hub
      number: 4
      mode:
        input: true
      inverted: false
    on_state:      
      then:
      - light.toggle:
          id: PWM_5

  - platform: gpio
    name: "Eingang IN6"
    id: Input_6
    pin: 
      pcf8574: pcf8574_hub
      number: 5
      mode:
        input: true
      inverted: false
    on_state:      
      then:
      - light.toggle:
          id: PWM_6

  - platform: gpio
    name: "Eingang IN7"
    id: Input_7
    pin: 
      pcf8574: pcf8574_hub
      number: 6
      mode:
        input: true
      inverted: false
    on_state:      
      then:
      - light.toggle:
          id: PWM_7

  - platform: gpio
    name: "Eingang IN8"
    id: Input_8
    pin: 
      pcf8574: pcf8574_hub
      number: 7
      mode:
        input: true
      inverted: false
    on_state:      
      then:
      - light.toggle:
          id: PWM_8

# Define PCA9685 as OUTPUT hub
pca9685:
  - id: pca9685_hub1
    #address: 0x00
    frequency: 250

#Define OUT channels
output:
  - platform: pca9685
    pca9685_id: 'pca9685_hub1'
    channel: 0
    id: "PWM1"

  - platform: pca9685
    pca9685_id: 'pca9685_hub1'
    channel: 1
    id: "PWM2"    

  - platform: pca9685
    pca9685_id: 'pca9685_hub1'
    channel: 2
    id: "PWM3"    

  - platform: pca9685
    pca9685_id: 'pca9685_hub1'
    channel: 3
    id: "PWM4"    

  - platform: pca9685
    pca9685_id: 'pca9685_hub1'
    channel: 4
    id: "PWM5"    

  - platform: pca9685
    pca9685_id: 'pca9685_hub1'
    channel: 5
    id: "PWM6"    

  - platform: pca9685
    pca9685_id: 'pca9685_hub1'
    channel: 6
    id: "PWM7"    

  - platform: pca9685
    pca9685_id: 'pca9685_hub1'
    channel: 7
    id: "PWM8"    



# Define lights using OUT channels
light:
  - platform: monochromatic
    output: PWM1
    name: "Ausgang OUT1"
    id: PWM_1 
  
  - platform: monochromatic
    output: PWM2
    name: "Ausgang OUT2"
    id: PWM_2 

  - platform: monochromatic
    output: PWM3
    name: "Ausgang OUT3"
    id: PWM_3 

  - platform: monochromatic
    output: PWM4
    name: "Ausgang OUT4"
    id: PWM_4 

  - platform: monochromatic
    output: PWM5
    name: "Ausgang OUT5"
    id: PWM_5

  - platform: monochromatic
    output: PWM6
    name: "Ausgang OUT6"
    id: PWM_6 

  - platform: monochromatic
    output: PWM7
    name: "Ausgang OUT7"
    id: PWM_7 

  - platform: monochromatic
    output: PWM8
    name: "Ausgang OUT8"
    id: PWM_8
      
